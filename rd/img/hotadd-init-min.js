KISSY.add("utils/asyncRequest/index",function(a){function e(a){var b=this;if(!(b instanceof e))return new e(a);this.form="",this.dataType="json",this.uri="",this.method="GET",this.data=null,this.bootloadable=!0,this.resList=[],a!=undefined&&this.setURI(a)}var b=a.DOM,c=a.Event,d=document;return a.mix(e.prototype,{handleSuccess:function(){return undefined},handleFailure:function(a){new APP.msgBox({type:"error",content:a.desc,dialogType:"msg",autoClose:!0,timeOut:3e3})},mapRes:function(){var a=document.getElemenHLGByTagName("link"),b=document.getElemenHLGByTagName("script");if(a.length)for(var c=0,d=a.length;c<d;c++)this.resList.push(a[c].href);if(b.length)for(var c=0,d=b.length;c<d;c++)this.resList.push(b[c].src)},setMethod:function(a){return this.method=a.toString().toUpperCase(),this},getMethod:function(){return this.method},setData:function(a){return this.data=a,this},getData:function(){return this.data},setForm:function(a){return this.form=a,this},getForm:function(){return this.form},setURI:function(a){return this.uri=a,this},getURI:function(){return this.uri.toString()},setDataType:function(a){return this.dataType=a,this},getDataType:function(){return this.dataType},setHandle:function(a){return this.handleSuccess=a,this},setErrorHandle:function(a){return this.handleFailure=a,this},dispatchResponse:function(a,b){b.handleSuccess(a);var c=a.onload;if(c)try{(new Function(c))()}catch(d){}},disableBootload:function(){return this.bootloadable=!1,this},enableBootload:function(){return this.bootloadable=!0,this},dispatchErrorResponse:function(a,b,c){b&&(b=="timeout"?alert("\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u662f\u5426\u8fde\u63a5\u6b63\u5e38"):alert("\u7cfb\u7edf\u51fa\u9519"+b+"\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5"))},send:function(){var b=this;b.method=="GET"&&b.data&&(b.uri+=(b.uri.indexOf("?")==-1?"?":"&")+b.data,b.data=null);var c=this;interpretResponse=function(a,b,c,d){var e=d;if(a.ajaxExpired!=null){window.location=a.ajaxRedirect;return}if(a.error)var f=e.handleFailure;else var f=e.dispatchResponse;f=f.shield(null,a,d),f=f.defer.bind(f),f()},a.ajax({form:b.form,type:b.method,url:b.uri,data:b.data,success:function(a,b,d){interpretResponse(a,b,d,c)},error:this.dispatchErrorResponse,dataType:b.dataType,timeout:60,async:!0,serializeArray:!1,complete:function(a,b,c){c=null}})}}),e}),KISSY.add("page/mods/upload",function(a,b,c){var d=a.DOM,e=a.Event,f=a.all;return uploadControl={tool:null,auth:null,loading:null,init:function(d){}}},{requires:["gallery/uploader/1.5/index","gallery/uploader/1.5/themes/imageUploader/index"]}),KISSY.add("utils/pagination/index",function(a){function e(a){var b=this;if(!(b instanceof e))return new e(a);this.pageNum=4,this.name=a,this.page=1,this.pageCount=200,this.argName="page"}var b=a.DOM,c=a.Event,d=document;return a.mix(e.prototype,{jump:function(){return undefined},checkPages:function(){isNaN(parseInt(this.page))&&(this.page=1),isNaN(parseInt(this.pageCount))&&(this.pageCount=1),this.page<1&&(this.page=1),this.pageCount<1&&(this.pageCount=1),this.page>this.pageCount&&(this.page=this.pageCount),this.page=parseInt(this.page),this.pageCount=parseInt(this.pageCount)},formatInputPage:function(a){var b=navigator.appName=="Microsoft Internet Explorer"?!0:!1;if(!b)var c=a.which;else var c=event.keyCode;return c==8||c==46||c>=48&&c<=57?!0:!1},toPage:function(a,b){var c=1,d=this;typeof a=="object"?c=a.options[a.selectedIndex].value:c=a,d.jump(c,b,"")},printHtml:function(a,c){return this.checkPages(),b.html(a,this._createHtml(c)),this},setPageCount:function(a){return this.pageCount=a,this},getPageCount:function(){return this.pageCount},setRender:function(a){return this.jump=a,this},setPageNum:function(a){return this.pageNum=a,this},setPage:function(a){return this.page=a,this}}),e}),KISSY.add("page/mods/hoturl",function(a,b,c,d,e,f){var g=a.all,h=a.Event,j="cs",k="ci";return DesignTool={itemFrontPageNum:3,itemPageId:1,itemPaginator:null,designToolDialog:null,designTooltbItem:[],init:function(){},renderCouponItems:function(){},renderMealItems:function(){},handleDesignPagination:function(){},renderDesignItems:function(){},initDesignItemList:function(){},renderCatsItems:function(){}}},{requires:["utils/pagination/index","switchable","xtemplate","bui/select","bui/overlay"]}),KISSY.add("page/hotadd-init",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var a=KISSY,o=a.DOM,p=a.Event;return addControl={msg:null,picDialog:null,picPaginator:null,paginator:null,imgInterval:null,resizableArr:[],areaitems:a.JSON.parse(itemsJson),init:function(){addControl.picDialog||(addControl.picDialog=new e.Dialog({width:660,mask:!1,title:'<div class="tool-nav"><ul><li class="selected">\u5bfc\u5165\u4ee3\u7801</li></ul></div>',contentId:"J_selectPic",elCls:"design-tool-dialog",align:{points:["cc","cc"],offset:[0,0]},footerStyle:{display:"none"},effect:{effect:"fade",duration:200}}),addControl.picDialog.render()),p.on("#J_linkTool","click",function(a){addControl.picDialog.show();p.on("#btns_impt","click",function(a){jQuery.ajax({type:'post',url:'show.php',data:{hiddenFv:$("input[name=hiddenFv]").val(),hiddenfgd:$("textarea[name=hiddenfgd]").val()},error:function(){},dataType:'json',success:function(data){new APP.msgBox({type:data['fonlore'],content:data['desc'],dialogType:"msg",autoClose:!0,timeOut:3e3});jQuery('#btnsggfdimptd').show().val(data['kdaffd']);if(data['error']!=1){setTimeout(function(){$("#btns_imptd").click()},800)}}});return false})}),addControl.msg=new c.LoadMask({el:"#J_TmHtml",msg:"\u63d0\u4ea4\u4e2d\uff0c\u8bf7\u7b49\u5f85\u4e00\u4f1a..."}),p.on("#J_imgUrl","valuechange",function(a){a.newVal!=a.prevVal&&(a.newVal||(a.newVal=""),addControl.setImg(a.newVal))}),d.init(function(a){addControl.setImg(a,"up")}),p.on("#J_uploadImg","click",function(a){p.fire(o.get("#J_UploaderBtn"),"click")}),p.on("#J_areaUrlVal","valuechange",function(a){if(a.newVal!=a.prevVal){var b=o.attr(a.currentTarget,"data-num"),c=o.query("#J_ConstrainBox .J_clickEle");o.attr(c[b],"data-link",a.newVal),addControl.savaParams()}}),p.on("#J_areatitle","valuechange",function(a){if(a.newVal!=a.prevVal){var b=o.attr(a.currentTarget,"data-num"),c=o.query("#J_ConstrainBox .J_clickEle");o.attr(c[b],"data-title",a.newVal),addControl.savaParams()}}),addControl.renderArea(1),addControl.initDD(),l.init(),p.on("#J_addLink","click",function(b){var c=o.val("#J_imgUrl");if(!a.trim(c)){new APP.msgBox({type:"error",content:"\u8bf7\u5148\u8bbe\u7f6e\u56fe\u7247",dialogType:"msg",autoClose:!0,timeOut:3e3});return}var d=/https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?\.(jpg|gif|png)/i;if(!d.test(c)){new APP.msgBox({type:"error",content:"\u56fe\u7247\u94fe\u63a5\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e",dialogType:"msg",autoClose:!0,timeOut:3e3});return}var e={width:100,height:100,left:0,top:0,link_url:"",title:""};addControl.areaitems.items.push(e),addControl.renderArea()}),p.on("#J_nextBtn","click",function(b){var c=o.val("#J_imgUrl");if(!a.trim(c)){new APP.msgBox({type:"error",content:"\u8bf7\u5148\u8bbe\u7f6e\u56fe\u7247",dialogType:"msg",autoClose:!0,timeOut:3e3});return}var d=/https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?\.(jpg|gif|png)/i;if(!d.test(c)){new APP.msgBox({type:"error",content:"\u56fe\u7247\u94fe\u63a5\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e",dialogType:"msg",autoClose:!0,timeOut:3e3});return}if(addControl.areaitems.items.length>0){var e=addControl.areaitems.items,f=!1,g=0;for(var h=0;h<e.length;h++){var d=/https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i;if(!d.test(e[h].link_url)){f=!0,g=h;break}}if(f){new APP.msgBox({type:"error",content:"\u70ed\u533a"+(g+1)+"\u94fe\u63a5\u8f93\u5165\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e",dialogType:"msg",autoClose:!0,timeOut:3e3});var i=o.children("#J_linkList");p.fire(i[g],"click");return}}addControl.goList()})},resizableFun:function(){var a=this,b=o.query("#J_ConstrainBox .active"),c=o.attr(b,"data-num"),d=o.query(".resizable-handler",b).length;d==0&&(a.resizableArr["resizable"+c]=(new i({node:b,handlers:["t","r","b","l","tl","br","bl"],prefixCls:""})).on("resize",function(a){var b=o.get("#J_ConstrainBox"),c=o.width(b),d=o.height(b),e=a.currentTarget.userConfig.node[0],f=o.width(e),g=o.height(e),h=a.currentTarget._height+a.currentTarget._top,i=c-a.currentTarget._left,j=d-a.currentTarget._top,k=a.currentTarget._width+a.currentTarget._left;switch(a.handler){case"t":g>=h&&o.css(e,{height:h,top:0});break;case"r":f>=i&&o.css(e,{width:i,right:0});break;case"b":g>=j&&o.css(e,{height:j,bottom:0});break;case"l":f>=k&&o.css(e,{width:k,left:0});break;case"tr":g>=h&&o.css(e,{height:h,top:0}),f>=i&&o.css(e,{width:i,right:0});break;case"tl":g>=h&&o.css(e,{height:h,top:0}),f>=k&&o.css(e,{width:k,left:0});break;case"br":g>=j&&o.css(e,{height:j,bottom:0}),f>=i&&o.css(e,{width:i,right:0});break;case"bl":g>=j&&o.css(e,{height:j,bottom:0}),f>=k&&o.css(e,{width:k,left:0});break;default:}}).on("resizeEnd",function(a){addControl.savaParams()}))},initDD:function(){var a=j.DDM,b=j.DraggableDelegate,c=new b({container:"#J_ConstrainBox",selector:".J_drag",move:!0,plugins:[new k({constrain:"#J_ConstrainBox"})]});c.on("drag",function(a){if(o.hasClass(a.target,".J_delArea"))return;var b=a.drag.get("node");if(!o.hasClass(b[0],"active")){o.removeClass(o.children("#J_ConstrainBox"),"active"),o.addClass(b[0],"active"),addControl.resizableFun();var c=o.attr(b[0],"data-num"),d=o.children("#J_linkList");p.fire(d[c],"click")}}),c.on("dragend",function(a){addControl.savaParams()})},setImg:function(a,b){var c=o.width("#J_ConstrainBox"),d=o.height("#J_ConstrainBox");if(!a){if(addControl.areaitems.items.length>0){o.css("#J_ConstrainBox",{width:"",height:""});var e=o.width("#J_ConstrainBox"),f=o.height("#J_ConstrainBox");c!=e&&d!=f?addControl.savaParams(0):addControl.savaParams()}else o.css("#J_ConstrainBox",{width:"",height:""}),addControl.savaParams();addControl.renderArea()}else{var g=/https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?\.(jpg|gif|png)/i;if(!g.test(a)){new APP.msgBox({type:"error",content:"\u56fe\u7247\u94fe\u63a5\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e",dialogType:"msg",autoClose:!0,timeOut:3e3});return}var h=new Image;h.src=a+"?"+Date.parse(new Date),addControl.imgInterval=setInterval(function(){if(h.width>0||h.height>0){clearInterval(addControl.imgInterval),o.val("#J_imgUrl",a),addControl.areaitems.width=h.width,addControl.areaitems.height=h.height;var e=addControl.areaitems.width,f=addControl.areaitems.height,g=o.width("#J_areaDesign");e>g&&(e=g,f=(g/addControl.areaitems.width*addControl.areaitems.height).toFixed(0)),o.css("#J_ConstrainBox",{width:e,height:f}),c!=e&&d!=f?addControl.savaParams(0):addControl.savaParams(),addControl.renderArea(),!b&&b!="up"&&(addControl.picDialog.hide(),new APP.msgBox({type:"success",content:"\u6dfb\u52a0\u6210\u529f",dialogType:"msg",autoClose:!0,timeOut:1500}))}},40)}},renderArea:function(b){var c=addControl.areaitems.width,d=addControl.areaitems.height,e=o.width("#J_areaDesign");if(c>e){c=e,d=(e/addControl.areaitems.width*addControl.areaitems.height).toFixed(0);var f=e/addControl.areaitems.width;a.each(addControl.areaitems.items,function(a){a.width=(a.width*f).toFixed(0),a.height=(a.height*f).toFixed(0),a.left=(a.left*f).toFixed(0),a.top=(a.top*f).toFixed(0)})}o.css("#J_ConstrainBox",{width:c,height:d});var h=o.html("#J_areaTemplet"),i=(new g(h)).render(addControl.areaitems);o.html("#J_ConstrainBox",i);var j=o.html("#J_selectTemplet"),k=(new g(j)).render(addControl.areaitems);o.html("#J_linkList",k),addControl.savaParams(),p.on(".J_clickEle","click",function(a){if(o.hasClass(a.target,".J_delArea"))return;if(!o.hasClass(a.currentTarget,"active")){o.removeClass(o.children("#J_ConstrainBox"),"active"),o.addClass(a.currentTarget,"active"),addControl.resizableFun();var b=o.attr(a.currentTarget,"data-num"),c=o.children("#J_linkList");p.fire(c[b],"click"),o.text("#J_areaIndex","\u70ed\u533a"+(Number(b)+1)+"\u94fe\u63a5\uff1a"),o.text("#J_arareatitle","\u9f20\u6807\u79fb\u52a8\u5230\u94fe\u63a5"+(Number(b)+1)+"\u4e0a\u663e\u793a\u6587\u5b57"),o.val("#J_areaUrlVal",addControl.areaitems.items[b].link_url),o.val("#J_areatitle",addControl.areaitems.items[b].title),o.attr("#J_areaUrlVal","data-num",b),o.attr("#J_areatitle","data-num",b)}o.show("#J_setLinkUrl")}),p.on(o.children("#J_linkList"),"click",function(a){o.removeClass(o.children("#J_linkList"),"active"),o.addClass(a.currentTarget,"active");var b=o.attr(a.currentTarget,"data-num"),c=o.query("#J_ConstrainBox .J_clickEle");p.fire(c[b],"click"),o.text("#J_areaIndex","\u70ed\u533a"+(Number(b)+1)+"\u94fe\u63a5\uff1a"),o.text("#J_arareatitle","\u9f20\u6807\u79fb\u52a8\u5230\u94fe\u63a5"+(Number(b)+1)+"\u4e0a\u663e\u793a\u6587\u5b57"),o.val("#J_areaUrlVal",addControl.areaitems.items[b].link_url),o.val("#J_areatitle",addControl.areaitems.items[b].title),o.attr("#J_areaUrlVal","data-num",b),o.attr("#J_areatitle","data-num",b)}),p.on(".J_delArea","click",function(a){var b=o.attr(a.currentTarget,"data-num"),c=addControl.areaitems.items.length,d=o.attr(o.query("#J_linkList .active"),"data-num");addControl.areaitems.items.splice(b,1),addControl.renderArea(0),addControl.resizableArr["resizable"+b]&&addControl.resizableArr["resizable"+b].destroy();var e=o.children("#J_linkList"),f=d;d>=b&&d>0&&(d-=1),e.length>0?p.fire(e[d],"click"):o.hide("#J_setLinkUrl")}),b&&b==1?p.fire(o.first("#J_linkList"),"click"):b!=0&&p.fire(o.last("#J_linkList"),"click")},savaParams:function(b){addControl.areaitems.pic_url=o.val("#J_imgUrl")||"https://img.alicdn.com/imgextra/i4/1761154159/TB21DZVkVXXXXbYXXXXXXXXXXXX-1761154159.jpg",addControl.areaitems.items=[];var c=o.query("#J_ConstrainBox .J_clickEle"),d=o.width("#J_areaDesign");a.each(c,function(a){var c={};if(b==0)c.width=100,c.height=100,c.left=0,c.top=0;else if(addControl.areaitems.width>d){var e=addControl.areaitems.width/d;c.width=(o.width(a)*e).toFixed(0),c.height=(o.height(a)*e).toFixed(0),c.left=(parseFloat(o.css(a,"left"))*e).toFixed(0),c.top=(parseFloat(o.css(a,"top"))*e).toFixed(0)}else c.width=o.width(a),c.height=o.height(a),c.left=parseFloat(o.css(a,"left")),c.top=parseFloat(o.css(a,"top"));c.link_url=addControl.strProcess(o.attr(a,"data-link")),c.title=addControl.strProcess(o.attr(a,"data-title")),addControl.areaitems.items.push(c)})},renderItems:function(b,c){a.each(b,function(a){c==0?(a.tab="public",a.tb_imgurl.indexOf("alimmdn")==-1?a.posterImg=a.tb_imgurl+"_300x300":a.posterImg=a.tb_imgurl+"@300w_300h_90Q.jpg"):(a.tab="shop",a.posterImg="")});var d={data:b},e=KISSY.all("#J_posterTemplet").html(),f=(new g(e)).render(d);c==0?o.html("#J_defaultPoster",f):o.html("#J_myPoster",f),p.on(".J_PosterClick","click",function(a){var b=o.attr(a.currentTarget,"data");addControl.setImg(b)}),p.on(".J_designPoster","click",function(a){var b=o.attr(a.currentTarget,"data-tid"),c=o.attr(a.currentTarget,"data-lid"),d=o.attr(a.currentTarget,"data-path"),e=o.attr(a.currentTarget,"data-type"),f=1920;if(e==3||e==4||e==7)f=1200;n.showDesign(b,d,c,f)})},renderPicItems:function(a){var b={data:a},c=o.html("#J_templet"),d=(new g(c)).render(b);o.html(o.get("#J_imgList"),d);var e=o.children("#J_imgList");p.on(e,"mouseenter mouseleave click",function(a){if(a.type=="mouseenter")o.addClass(a.currentTarget,"kcopy-is-hover");else if(a.type=="mouseleave")o.removeClass(a.currentTarget,"kcopy-is-hover");else if(a.type=="click"){var b=o.attr(a.currentTarget,"data-text");addControl.setImg(b)}})},goList:function(){var a=function(a){addControl.msg.hide(),new APP.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u751f\u6210\u6210\u529f",forumresu:a.fonload,type:"success",buttons:[{value:"\u590d\u5236\u4ee3\u7801"},{value:"\u7ee7\u7eed\u5236\u4f5c"}],success:function(a){a=="\u590d\u5236\u4ee3\u7801"}})},c=function(a){addControl.msg.hide(),new APP.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,forumresu:a.fonload,type:"error"})};addControl.msg.show();var dprdzxc=$("input[name=dprdzxc]:checked").val(),cpkqkyd=$("input[name=cpkqkyd]:checked").val(),cqkyd=$("input[name=cqkyd]:checked").val();var d={dprdzxc:dprdzxc,cpkqkyd:cpkqkyd,cqkyd:cqkyd,mods:KISSY.JSON.stringify(addControl.areaitems)};(new b).setURI(goListUrl).setMethod("POST").setHandle(a).setErrorHandle(c).setData(d).send()},strProcess:function(a){return a}}},{requires:["utils/asyncRequest/index","bui/mask","./mods/upload","bui/overlay","bui/select","xtemplate","utils/pagination/index","resizable","dd","dd/plugin/constrain","./mods/hoturl","switchable"]});function dd_copy(){$(".bui-button-primary").zclip('remove').zclip({path:"/rd/ZeroClipboard.swf",copy:function(){return $("#forumresult1").val()},beforeCopy:function(){},afterCopy:function(){new APP.msgBox({type:"info",content:"\u590d\u5236\u6210\u529f\u0020\u8bf7\u7c98\u8d34\u5230\u6a21\u677f\u76f8\u5e94\u7684\u4f4d\u7f6e",dialogType:"msg",autoClose:!0,timeOut:3e3})}})};function reconvert(str){str=str.replace(/(\\u)(\w{1,4})/gi,function($0){return(String.fromCharCode(parseInt((escape($0).replace(/(%5Cu)(\w{1,4})/g,"$2")),16)))});str=str.replace(/(&#x)(\w{1,4});/gi,function($0){return String.fromCharCode(parseInt(escape($0).replace(/(%26%23x)(\w{1,4})(%3B)/g,"$2"),16))});str=str.replace(/(&#)(\d{1,6});/gi,function($0){return String.fromCharCode(parseInt(escape($0).replace(/(%26%23)(\d{1,6})(%3B)/g,"$2")))});return str};